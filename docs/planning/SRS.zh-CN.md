# 完整需求说明（SRS）

## 1. 文档信息
- 项目名称：基于 Debian 的自建 NAS Web 仪表盘系统
- 文档版本：v1.0
- 更新时间：2026-02-11
- 适用范围：Debian + Docker 单机 NAS 场景（局域网优先）

## 2. 项目背景与目标
你希望从 fnOS 迁移到 Debian，保留“统一入口 + 可视化管理”的体验，同时获得完整的系统可控性。

核心目标：
- 一个 Web 地址统一访问影视、下载、容器与系统状态
- 保持轻量、可长期维护、不依赖大型数据库
- 在 Docker 化前提下实现可观测、可操作、可扩展

## 3. 现状与约束
- 系统：Debian
- 编排：Docker + Docker Compose
- 现有服务：Jellyfin、qBittorrent、Portainer、Watchtower
- 数据目录：
- `/srv/media`
- `/srv/downloads`
- `/srv/docker`

硬性约束：
- 仪表盘系统必须运行在 Docker 中
- 默认局域网部署
- 不直接将 Docker Socket 暴露公网
- 不引入重量级数据库（优先 SQLite）
- 证书签发使用 Cloudflare DNS
- 公网访问场景下不开放 80/443/8080 入站端口

## 4. 范围定义
### 4.1 In Scope（本期范围）
- Dashboard 总览
- 容器管理（Docker）
- 影视聚合（Jellyfin API）
- 下载管理（qBittorrent API）
- 统一入口与反向代理路径聚合
- 基础登录认证与安全基线

### 4.2 Out of Scope（非目标）
- RAID 创建/修复/扩容管理
- 专业文件管理器替代方案
- 企业级 RBAC 多租户权限体系
- 复杂工作流引擎

## 5. 信息架构（IA）
参考你提供截图，采用“左侧导航 + 主内容区 + 列表卡片 + 弹窗操作”的一致模式。

一级导航：
- 总览（Dashboard）
- 容器管理
- 影视管理
- 下载管理
- 系统状态
- 设置（入口、认证、代理、日志）

统一交互约定：
- 顶栏右侧固定：搜索、刷新、主按钮（新增/添加）
- 列表项左侧：状态点（绿运行、灰停止、红异常）
- 列表项右侧：快捷操作（启停/重启/更多）
- 弹窗：标题、表单区、主次按钮（取消/确认）

## 6. 功能需求
## 6.1 Dashboard（总览）
### FR-DASH-001 容器总览
- 显示总容器数、运行中、异常、已停止
- 异常容器以红色告警卡片展示
- 点击统计数字可跳转到容器列表过滤结果

### FR-DASH-002 Jellyfin 状态
- 显示当前播放会话数
- 显示“继续观看”条目（封面、进度、标题）
- 显示“最近添加”条目（封面、标题、添加时间）
- 支持点击跳转 Jellyfin 对应播放页

### FR-DASH-003 qBittorrent 状态
- 显示下载中任务数、做种数、已完成数
- 显示实时下载/上传速率
- 展示最近完成下载（最近 N 条）

### FR-DASH-004 系统资源
- CPU 使用率（实时折线）
- 内存使用率（实时折线）
- 磁盘占用率与可用容量（按挂载点）
- 网络上下行速率（实时曲线）

### FR-DASH-005 刷新机制
- 自动轮询间隔可配置（默认 5 秒）
- 支持手动刷新
- 超时或失败时显示“部分数据不可用”而非整页失败

## 6.2 容器管理模块
### FR-CTR-001 容器列表
- 字段：名称、项目/Compose 归属、状态、CPU、内存、网络 IO、端口映射
- 支持搜索、状态筛选、分页

### FR-CTR-002 容器控制
- 操作：启动、停止、重启
- 批量操作：批量启动/停止（可选）
- 关键动作二次确认

### FR-CTR-003 日志查看
- 查看最近 N 行（默认 200 行）
- 支持“跟随滚动”与关键字过滤
- 支持下载日志片段

### FR-CTR-004 镜像更新
- 单容器手动更新流程：
- 拉取最新镜像
- 重建并启动
- 返回更新结果（成功/失败+错误信息）

### FR-CTR-005 端口映射展示
- 展示容器端口与宿主端口映射
- 提供“复制地址”快捷操作

## 6.3 影视管理模块（Jellyfin）
### FR-MEDIA-001 继续观看
- 调用 Jellyfin 用户 Resume 数据
- 显示进度条与剩余时长

### FR-MEDIA-002 最近添加
- 按时间倒序显示最近入库内容
- 支持按类型过滤（电影/剧集/音乐/其他）

### FR-MEDIA-003 活跃会话
- 显示设备名、用户名、播放内容、播放进度、码率信息（如可用）

### FR-MEDIA-004 快捷跳转
- 一键打开 Jellyfin 对应页面或播放页

### FR-MEDIA-005 媒体库刷新
- 手动触发刷新任务
- 显示触发结果与最后刷新时间

## 6.4 下载管理模块（qBittorrent）
### FR-DL-001 任务列表
- 字段：名称、进度、状态、下载速度、上传速度、剩余时间、大小、标签
- 支持分类筛选（全部/下载中/完成/暂停/错误/做种）

### FR-DL-002 任务控制
- 暂停、继续、删除（可选删除数据）
- 支持多选批量操作

### FR-DL-003 新增任务
- 支持磁力链接添加
- 支持 `.torrent` 文件上传
- 支持下载目录选择

### FR-DL-004 最近完成
- 显示最近完成任务列表
- 可一键触发 Jellyfin 刷新（可配置自动触发）

## 6.5 统一入口与聚合
### FR-GW-001 单入口
- 对外统一地址：`https://nas.local`（示例）

### FR-GW-002 路径聚合
- `/` 仪表盘
- `/media` Jellyfin（或内嵌聚合页）
- `/downloads` 下载页
- `/containers` 容器页

### FR-GW-003 端口隐藏
- 用户不需要记忆 8096、8080、9000 等原始端口

## 6.6 设置与安全
### FR-SEC-001 登录认证
- 最低支持本地账号密码登录
- 会话过期与自动登出策略可配置

### FR-SEC-002 Docker 安全
- 使用 Docker Socket Proxy
- 仅开放最小化 API 权限

### FR-SEC-003 HTTPS（可选但推荐）
- 支持自签证书或 ACME 证书
- 支持内网证书切换
- 支持 Cloudflare DNS Challenge 自动签发与续期

### FR-SEC-003A SSL 管理面板
- 提供统一证书管理界面（域名、签发方式、到期日、续期状态）
- 支持手动签发、手动续期、吊销、导入自定义证书
- 支持证书绑定到多个业务路由/服务
- 支持未来新增业务共用证书管理能力

### FR-SEC-004 审计日志
- 记录关键操作：登录、容器启停、删除任务、刷新媒体库

## 7. 外部系统与 API 集成
## 7.1 Docker Engine API
- 读取：容器列表、状态、统计、日志、镜像
- 操作：start/stop/restart/pull/recreate（按安全策略开放）

## 7.2 Jellyfin API
- 会话：`/Sessions`
- 继续观看：`/Users/{userId}/Items/Resume`
- 最近添加：`/Users/{userId}/Items/Latest`
- 刷新：`/Library/Refresh`

## 7.3 qBittorrent Web API
- 登录：`/api/v2/auth/login`
- 任务：`/api/v2/torrents/info`
- 实时状态：`/api/v2/sync/maindata`
- 操作：pause/resume/delete/add

## 8. 非功能需求（NFR）
- 启动时间：容器冷启动后 10 秒内可访问登录页
- Dashboard 首屏：局域网内 P95 < 2 秒
- 轮询稳定性：连续运行 7 天无内存泄漏级增长
- 可维护性：模块化目录，API 适配层与 UI 分层
- 可观测性：健康检查、结构化日志、错误追踪

## 9. 数据与存储
- 主存储：SQLite（配置、账号、偏好、审计日志）
- 缓存：进程内缓存或轻量 Redis（可选）
- 敏感信息：通过环境变量或 Docker Secret 管理

## 10. UI 规范（基于截图提炼）
- 布局：左侧导航固定，右侧内容区卡片化
- 风格：浅色主题、低饱和灰背景、蓝色强调色
- 状态色：
- 正常/运行：绿色
- 停止/禁用：灰色
- 异常/失败：红色
- 主操作按钮：蓝底白字，位于工具栏右侧
- 列表项：圆角卡片 + 状态点 + 操作图标
- 弹窗：居中、遮罩、主次按钮右下对齐

## 11. 部署建议（Docker）
- `dashboard-web`：前端
- `dashboard-api`：后端 API
- `docker-socket-proxy`：Docker 安全代理
- `reverse-proxy`：反向代理（统一入口与 TLS）
- `ssl-panel`：SSL 管理面板（Cloudflare DNS）
- `auth-gateway`（推荐）：二次认证网关（公网场景）

建议网络：
- 内部网络：`nas_internal`
- 公网模式仅暴露单一高位端口（示例：`24443`）
- 所有业务容器仅内网互通，不直接对公网暴露

公网访问建议模式（按安全优先级）：
- 模式 A（推荐）：VPN/Zero-Trust 后访问管理面板，无公网暴露后端管理端口
- 模式 B：高位端口 + HTTPS + 二次认证 + 限流/封禁

## 12. 验收标准（UAT）
- 能用一个地址登录并访问四大模块（总览/容器/影视/下载）
- Dashboard 数据可实时刷新且核心指标正确
- 容器启停、日志、更新可执行且有反馈
- 下载任务增删改查与速度展示可用
- Jellyfin 继续观看、最近添加、会话、刷新可用
- Docker Socket 未直接暴露公网
- 基础认证可用，未登录不可访问核心页面
- 证书可通过 Cloudflare DNS 自动签发和续期
- 高位端口公网访问可用，且具备基础防护能力

## 13. 版本规划建议
- v1.0（MVP）：总览 + 容器基础控制 + 下载基础控制 + Jellyfin 聚合
- v1.1：容器更新工作流完善、批量操作、操作审计增强
- v1.2：通知中心、更多自动化策略、可视化报表增强
