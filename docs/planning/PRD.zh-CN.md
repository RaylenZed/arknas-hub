# PRD：基于 Debian 的自建 NAS Web 仪表盘

## 1. 产品概述
本产品是一个运行在 Debian + Docker 上的统一管理入口，聚合 Docker、Jellyfin、qBittorrent 三类核心能力，提供接近 fnOS 首页体验的 Web 仪表盘。

产品一句话：
一个地址，完成影视、下载、容器、系统状态的统一可视化管理。

## 2. 目标与成功标准
### 2.1 产品目标
- 降低多端口、多后台切换成本
- 提供“可观测 + 可控制”的单入口体验
- 在轻量架构下实现可持续维护

### 2.2 成功指标（上线后 30 天）
- 90% 日常操作可在仪表盘完成，无需跳转原生后台
- 关键页面首屏 P95 < 2 秒（局域网）
- 容器操作成功率 > 99%
- 日常运维时间下降 40%（主观或日志统计）

## 3. 目标用户与场景
- 用户画像：具备 Linux/Docker 基础的家庭或个人 NAS 管理者
- 主要场景：
- 查看系统是否健康（容器、资源、下载、播放）
- 快速处理异常容器
- 直接管理下载任务并联动媒体刷新
- 统一入口访问媒体服务

## 4. 产品范围
### 4.1 MVP 范围
- Dashboard 总览
- 容器管理（列表、启停、重启、日志、手动更新）
- 影视管理（继续观看、最近添加、活跃会话、刷新）
- 下载管理（任务列表、状态、控制、添加任务）
- 登录认证、反向代理聚合
- SSL 管理面板（Cloudflare DNS 签发/续期）

### 4.2 本期不做
- RAID、文件系统高级管理
- 企业级多角色权限体系
- 跨节点集群编排

## 5. 页面与交互设计（参考截图）
## 5.1 全局框架
- 左侧固定导航（图标 + 文本）
- 顶部工具栏（搜索、刷新、主按钮）
- 主内容区域为卡片列表与图表组合
- 统一弹窗模型（标题、表单、取消/确认）

## 5.2 Dashboard 页面
### 目标
用一屏完成健康总览，先看异常，再看细节。

### 模块
- 异常告警卡：容器异常、服务不可达、API 失败
- Docker 服务卡：状态开关、存储位置、开机自启状态
- 资源图表区：CPU、内存、网络、磁盘
- 业务摘要区：Jellyfin 播放/新增、qB 下载/完成

### 交互
- 点击告警卡进入对应模块过滤视图
- 图表支持最近 1m/5m/15m 切换（MVP 可先固定 5m）
- 失败模块显示“重试”按钮，不阻塞其他模块

## 5.3 容器管理页面
### 列表字段
- 状态点
- 容器名
- 项目名（Compose）
- CPU %
- 内存
- 网络上/下行
- 端口映射
- 快捷操作（启停、重启、更多）

### 工具栏
- 搜索
- 刷新
- 主按钮：添加容器/新建项目（按实现方式）

### 详情抽屉/弹窗
- 基本信息（镜像、创建时间、重启策略）
- 日志（最近 N 行）
- 端口、挂载、网络
- 更新镜像并重建

### 状态定义
- 绿色：运行中
- 灰色：已停止
- 红色：异常退出

## 5.4 影视管理页面
### 模块
- 继续观看（卡片流）
- 最近添加（时间倒序）
- 当前活跃播放会话（表格/列表）
- 操作区（打开 Jellyfin、刷新媒体库）

### 关键交互
- 卡片点击跳转 Jellyfin 对应页面
- 会话条目展示设备、用户、进度、码率
- 刷新按钮触发后显示任务状态（处理中/成功/失败）

## 5.5 下载管理页面
### 结构（对齐截图范式）
- 左侧任务分类：全部、下载中、完成、做种、活动、空闲、暂停、错误
- 顶部操作栏：添加任务、开始、暂停、删除、搜索
- 主列表：名称、进度、速度、剩余时间、状态
- 底部状态栏：实时上下行速度

### 新增任务弹窗
- 文本框支持磁力/http/https/ftp/ftps，多行批量
- 种子文件上传
- 下载目录选择
- 校验失败时显示明确错误原因

## 5.6 设置页面
### 设置项（MVP 必要）
- 入口设置（HTTP/HTTPS 端口）
- 账号安全（修改密码、会话策略）
- API 连接配置（Docker/Jellyfin/qB）
- 证书配置（可选）

### 高级设置（可延期）
- 代理加速、镜像源
- 通知渠道（邮件/IM Webhook）

## 5.7 SSL 管理面板（新增）
### 目标
给当前和未来业务提供统一证书生命周期管理，不依赖 80/443 入站端口。

### 核心能力
- 域名证书申请（Cloudflare DNS Challenge）
- 自动续期计划与续期状态展示
- 证书到期预警（7/15/30 天）
- 证书绑定路由（将证书分配给反向代理站点）
- 导入/导出证书（PEM）

### 页面结构
- 证书列表：域名、颁发机构、签发时间、到期时间、状态、操作
- 证书详情：SAN、链完整性、绑定服务、续期日志
- Cloudflare 凭据页：Token 配置与连通性校验

## 6. 字段与数据定义（核心）
## 6.1 容器状态对象
- `id`
- `name`
- `status`
- `project`
- `cpu_percent`
- `memory_used_mb`
- `net_in_kbps`
- `net_out_kbps`
- `ports[]`
- `last_error`

## 6.2 下载任务对象
- `hash`
- `name`
- `state`
- `progress`
- `dlspeed`
- `upspeed`
- `eta`
- `size`
- `save_path`
- `completed_on`

## 6.3 Jellyfin 媒体对象
- `id`
- `title`
- `type`
- `image_url`
- `progress`
- `added_at`
- `play_url`

## 7. 权限与安全
- 登录后访问控制（未登录跳转登录页）
- 所有后端 API 需鉴权
- Docker API 仅经 `docker-socket-proxy` 访问
- 关键操作记录审计日志
- 默认仅内网访问；公网需显式开启并配置 HTTPS
- 公网不开放 80/443/8080 时，采用高位端口 HTTPS + Cloudflare DNS 签发
- 管理面板支持额外鉴权层（MFA/SSO，可在 v1.1 增加）

## 8. 性能与稳定性要求
- 轮询周期默认 5 秒，可调 3~15 秒
- 单页 API 并发请求上限受控（避免雪崩）
- 第三方 API 失败重试最多 2 次
- API 超时默认 3 秒，支持配置

## 9. 技术方案（建议）
- 前端：React + TypeScript + 组件化卡片/列表系统
- 后端：Node.js/NestJS 或 Go（任选其一，偏轻量）
- 存储：SQLite
- 反向代理：Nginx/Caddy/Traefik（单入口）
- SSL 管理：带 Web UI 的证书管理服务（Cloudflare DNS）
- 部署：Docker Compose

## 10. 版本计划
### Milestone 1（第 1-2 周）
- 项目骨架、登录、全局布局、统一路由
- Docker 数据打通（只读）

### Milestone 2（第 3-4 周）
- 容器启停/重启/日志
- Dashboard 系统资源图表

### Milestone 3（第 5-6 周）
- qBittorrent 管理闭环（查/增/控）
- Jellyfin 继续观看/最近添加/会话

### Milestone 4（第 7 周）
- 统一入口代理、TLS、SSL 管理面板、审计日志
- 回归测试与上线文档

## 11. 验收标准
- 可以通过一个统一地址完成登录与模块切换
- 四个核心模块均有可用数据与操作闭环
- 容器管理动作有成功/失败可见反馈
- 下载任务可新增、暂停、恢复、删除
- Jellyfin 数据可展示并支持刷新动作
- 出现 API 失败时页面不崩溃，可局部降级
- 可在不开放 80/443/8080 的条件下完成证书签发与续期
- 未来新增业务可在 SSL 管理面板中复用证书管理流程

## 12. 风险与应对
- 第三方 API 版本变化：适配层封装 + 错误码映射
- Docker 权限风险：socket proxy + 最小权限
- 轮询带来负载：缓存、节流、分级刷新
- 单人维护压力：模块化目录 + 明确接口契约 + 文档先行

## 13. UI 细节规范（高优先）
- 列表项高度统一，避免跳动
- 所有可点击卡片必须有 hover 与 pointer
- 状态点 + 文案双重表达，不能只靠颜色
- 空状态需有引导动作（如“添加任务”）
- 操作确认弹窗默认焦点放在安全选项（取消）
- 异步操作统一 Toast：进行中/成功/失败

## 14. 上线后优化清单（Next）
- 通知中心（容器异常、下载完成）
- 自动规则（下载完成触发媒体刷新）
- 服务健康评分（按错误率和可用率计算）
- 主题与布局自定义
