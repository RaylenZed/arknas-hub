{
    email {$ACME_EMAIL}
    acme_dns cloudflare {$CF_DNS_API_TOKEN}
}

{$BASE_DOMAIN}:{$JELLYFIN_HTTPS_PORT} {
    reverse_proxy jellyfin:8096 {
        header_up Host {host}
        header_up X-Real-IP {remote_host}
        header_up X-Forwarded-For {remote_host}
        header_up X-Forwarded-Proto https
        header_up X-Forwarded-Host {host}
    }
}

{$BASE_DOMAIN}:{$QBIT_HTTPS_PORT} {
    reverse_proxy qbittorrent:8080 {
        # qBittorrent WebUI is strict about Origin/Host checks behind reverse proxy.
        # Keep upstream Host internal, while forwarding external host:port explicitly.
        header_up Host qbittorrent:8080
        header_up X-Forwarded-Host {http.request.header.Host}
        header_up X-Real-IP {remote_host}
        header_up X-Forwarded-Proto https
        header_up -Origin
        header_up -Referer
    }
}

{$BASE_DOMAIN}:{$OPENLIST_HTTPS_PORT} {
    reverse_proxy openlist:5244 {
        header_up Host {host}
        header_up X-Real-IP {remote_host}
        header_up X-Forwarded-For {remote_host}
        header_up X-Forwarded-Proto https
        header_up X-Forwarded-Host {host}
    }
}
